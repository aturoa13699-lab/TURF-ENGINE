name: Publish site & email URL

on:
  workflow_dispatch:
    inputs:
      run_date:
        description: "YYYY-MM-DD (blank = today Australia/Sydney)"
        required: false
        default: ""
      send_email:
        description: "Send email (only works if SMTP secrets are configured)"
        required: false
        type: boolean
        default: false
  schedule:
    - cron: "15 20 * * *"

jobs:
  publish:
    uses: ./.github/workflows/site_build_and_deploy.yml
    with:
      mode: demo-run
      run_date: ${{ inputs.run_date || '' }}
      stake_cards_path: out/stake_cards
      send_email: ${{ inputs.send_email || false }}
      upload_publish_json: true
    secrets:
      SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
      SMTP_PORT: ${{ secrets.SMTP_PORT }}
      SMTP_USERNAME: ${{ secrets.SMTP_USERNAME }}
      SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
      MAIL_FROM: ${{ secrets.MAIL_FROM }}
      MAIL_TO: ${{ secrets.MAIL_TO }}
