name: TURF ENGINE LITE â€” Site

on:
  schedule:
    - cron: "30 3 * * *"
  workflow_dispatch:
    inputs:
      date:
        description: "Run date (YYYY-MM-DD, Australia/Sydney). Defaults to today."
        required: false
        type: string

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  resolve-date:
    runs-on: ubuntu-latest
    outputs:
      run_date: ${{ steps.date.outputs.run_date }}
      artifact_name: ${{ steps.date.outputs.artifact_name }}
    steps:
      - name: Resolve run date
        id: date
        run: |
          if [ -n "${{ github.event.inputs.date }}" ]; then
            RUN_DATE="${{ github.event.inputs.date }}"
          else
            RUN_DATE="$(TZ=Australia/Sydney date +%Y-%m-%d)"
          fi
          echo "run_date=${RUN_DATE}" >> "$GITHUB_OUTPUT"
          echo "artifact_name=turf-daily-${RUN_DATE}" >> "$GITHUB_OUTPUT"
          echo "Resolved: date=${RUN_DATE}, artifact=turf-daily-${RUN_DATE}"

  site:
    needs: resolve-date
    uses: ./.github/workflows/site_build_and_deploy.yml
    with:
      mode: artifact
      run_date: ${{ needs.resolve-date.outputs.run_date }}
      artifact_name: ${{ needs.resolve-date.outputs.artifact_name }}
      stake_cards_path: out/stake_cards
      send_email: false
      upload_publish_json: true
